name: Android CI Build with Qt 6

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  # UmoÅ¼liwia rÄ™czne uruchomienie workflow z interfejsu GitHub
  workflow_dispatch:

jobs:
  build_android:
    # UÅ¼ywamy najnowszego Ubuntu
    runs-on: ubuntu-latest
    
    # Definiowanie zmiennych Å›rodowiskowych uÅ‚atwiajÄ…cych zarzÄ…dzanie Å›cieÅ¼kami
    env:
      QT_VERSION: 6.7.0
      ANDROID_NDK_VERSION: r26b # Wersja NDK kompatybilna z Qt 6.7.0

    steps:
    - name: ğŸ›ï¸ Checkout code
      uses: actions/checkout@v4
      with:
        submodules: true # W razie potrzeby pobrania submoduÅ‚Ã³w

    - name: ğŸ› ï¸ Install Java (JDK 17) and setup Android SDK
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
        cache: 'gradle'

    - name: ğŸ“¥ Install Qt 6 (${{ env.QT_VERSION }}) for Android
      # UÅ¼ywamy akcji jurplel/install-qt-action do pobrania i instalacji Qt
      uses: jurplel/install-qt-action@v3
      id: install_qt
      with:
        version: ${{ env.QT_VERSION }}
        host: linux
        target: android
        # Docelowa architektura: arm64-v8a to standard dla nowoczesnych urzÄ…dzeÅ„
        arch: android_arm64-v8a 
        android-ndk-version: ${{ env.ANDROID_NDK_VERSION }}
        # Akcja sama pobierze Android SDK do cache
        cached: 'true'

    - name: ğŸ”— Set up environment variables (NDK, Qt PATH)
      run: |
        # Ustawienie zmiennych Å›rodowiskowych NDK, ktÃ³re sÄ… niezbÄ™dne dla CMake
        echo "ANDROID_NDK_ROOT=${{ steps.install_qt.outputs.ndk-root }}" >> $GITHUB_ENV
        echo "ANDROID_SDK_ROOT=${{ steps.install_qt.outputs.sdk-root }}" >> $GITHUB_ENV
        # Dodanie katalogu z binarnymi Qt do PATH
        echo "${{ steps.install_qt.outputs.qt-root }}/bin" >> $GITHUB_PATH

    - name: âš™ï¸ Configure and Build Qt Project
      run: |
        mkdir build
        cd build
        
        # Konfiguracja za pomocÄ… CMake
        cmake .. \
          -DCMAKE_BUILD_TYPE=Release \
          -DCMAKE_INSTALL_PREFIX="../install" \
          -DCMAKE_PREFIX_PATH=${{ steps.install_qt.outputs.qt-root }} \
          -DANDROID_ABI="arm64-v8a" \
          -DANDROID_NATIVE_API_LEVEL=24 \
          -DANDROID_SDK_ROOT=$ANDROID_SDK_ROOT \
          -DANDROID_NDK=$ANDROID_NDK_ROOT
          
        # Kompilacja projektu
        cmake --build . --config Release

    - name: ğŸ“¦ Deploy/Package Android APK
      # UÅ¼ycie narzÄ™dzia androiddeployqt do spakowania APK
      # ZakÅ‚adamy, Å¼e gÅ‚Ã³wny cel (target) w CMake ma nazwÄ™ 'kleiner-brauhelfer-app'
      run: |
        cd build
        ${{ steps.install_qt.outputs.qt-root }}/bin/androiddeployqt \
          --output $PWD/android-build \
          --input android-libkleiner-brauhelfer-app.so \
          --deployment bundled \
          --release \
          --jdk ${{ steps.install_qt.outputs.java-home }}
          
    - name: ğŸ“¤ Upload APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: kleiner-brauhelfer-android-apk
        # Standardowa Å›cieÅ¼ka dla APK generowanego przez androiddeployqt
        path: build/android-build/bin/QtApp-release.apk

### ğŸš€ Podsumowanie zmian i kluczowych elementÃ³w:

1.  **Wersja Qt:** UÅ¼yto **`6.7.0`** jako stabilnego i dostÄ™pnego zamiennika.
2.  **Zmienne Åšrodowiskowe:** Ustawiono zmienne `ANDROID_NDK_VERSION` oraz dynamiczne Å›cieÅ¼ki NDK i SDK, co jest krytyczne dla kompilacji Androida.
3.  **Deploy:** W kroku `Deploy/Package Android APK` wykorzystano `androiddeployqt` â€“ kluczowe narzÄ™dzie Qt do tworzenia gotowego pliku APK z biblioteki `.so`.
4.  **Artifact:** Gotowy plik APK jest udostÄ™pniony jako artefakt akcji.

Czy chciaÅ‚byÅ›, abym zmodyfikowaÅ‚ docelowÄ… architekturÄ™ Androida (obecnie `arm64-v8a`) lub wersjÄ™ NDK?
